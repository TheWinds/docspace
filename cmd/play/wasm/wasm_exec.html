<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>MKDOC playground</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.21.0/themes/prism.css">
    <link rel="stylesheet" href="prism-live.css">
</head>

<body>

<script src="memfs.js"></script>
<script src="wasm_exec.js"></script>

<script>
    if (!WebAssembly.instantiateStreaming) { // polyfill
        WebAssembly.instantiateStreaming = async (resp, importObject) => {
            const source = await (await resp).arrayBuffer();
            return await WebAssembly.instantiate(source, importObject);
        };
    }

    const go = new Go();
    let mod, inst;
    WebAssembly.instantiateStreaming(fetch("play.wasm"), go.importObject).then((result) => {
        mod = result.module;
        inst = result.instance;
        document.getElementById("runButton").disabled = false;
    }).catch((err) => {
        console.error(err);
    });

    async function run() {
        console.clear();
        await go.run(inst);
        inst = await WebAssembly.instantiate(mod, go.importObject); // reset instance
    }
</script>

<div>
    <div style=" width: 300px; position: absolute;top: 400px; left: 20px;">
        <button onClick="run();" id="runButton" disabled>生成文档</button>
    </div>
    <div style="display: inline-block;width: 300px">
        <span>source files</span>
        <pre class="prism-live">
            <code>
.
├── conf.yaml
└── src
    ├── api.go
    ├── go.mod
    ├── model
    │   └── user.go
    └── view
        └── base_view.go
</code>
        </pre>
    </div>
    <div style="display: inline-block;width: 500px">
        <span>conf.yaml</span>
        <pre class="prism-live" style="--max-height:30em;"><code id="code-conf" class="language-yaml">name: mkdoc example
desc: this doc is auto generated by [mkdoc](https://github.com/TheWinds/mkdoc)
api_base_url: "http://localhost:8080"
mime:
  in:  json
  out: json
scanner:
  - gofunc
generator:
  - markdown
  - insomnia
  - docsify
args:
  enable_go_mod: true
  path: "./src"</code></pre>
    </div>
    <div style="display: inline-block;width: 500px">
        <span>model/user.go</span>
        <pre class="prism-live" style="--max-height:30em;"><code id="code-user" class="language-go">package model

type User struct {
	// ID
	ID int64 `json:"id"`
	// 用户名
	Name string `json:"name"`
	// 密码
	Password string `json:"pwd"`
	// 年龄
	// 这是年龄字段
	Age     int      `json:"age"`
	Profile *Profile `json:"profile"`
}

type Profile struct {
	Friends []User       `json:"friends"`
	Son     User         `json:"son"`
	Address []Address    `json:"address"`
	TTT     [][]int      `json:"ttt"`
	SSS     [][][]string `json:"sss"`
	Phone   string
}

type Address struct {
	// 代码
	Code int `json:"code"`
	// 详细地址
	Addr string `json:"addr"`
}</code></pre>
    </div>
    <div style="display: inline-block;width: 500px;height: 300px;">
        <span>api.go</span>
        <pre class="prism-live" style="--max-height:30em;"><code id="code-api" class="language-go">package src

import (
	"context"
	"github.com/thewinds/mkdoc/example/model"
)

var user *model.User

// @doc 创建用户
// create a user
// @tag user
// @path /api/user @method post
// @in fields {
//   name string 用户名
//   pwd  string 密码
//   age  int    年龄
// }
// @out type model.User
func CreateUser(ctx context.Context) {
	// ...
}

type CreateUserV2Req struct {
	// 用户名
	Name string `json:"name"`
	// 密码
	Password string `json:"pwd"`
	// 年龄
	Age int `json:"age"`
}

// @doc 获取用户
// get user by id
// @tag user
// @path /api/v2/user @method post
// @query uid 用户ID
// @in  type CreateUserV2Req
// @out type model.User
func CreateUserV2() {
	// ...
}

// @doc 搜索用户
// get user by id
// @tag user
// @path /api/user/ @method get
// @query uid  用户ID
// @query age  年龄
// @query name 名称
// @out type []model.User
func GetUsers() {
	// ...
}

// @doc AAA
// get user by id
// @tag user
// @path /api/aaa/ @method get
// @query uid  用户ID
// @query age  年龄
// @query name 名称
// @out type string
func AAA() {
	// ...
}</code></pre>
    </div>
    <div id="app-container">
        <iframe id="doc-result" width="100%" height="800px" src="doc_page.html"></iframe>
    </div>
</div>

<script>
    function reloadDoc(data) {
        // save generated doc file from localStorage
        localStorage.setItem("docs.md", data);
        setTimeout(()=>{
            document.getElementById('doc-result').contentWindow.location.href = 'doc_page.html';
        },1000);
    }
</script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.21.0/prism.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.21.0/components/prism-yaml.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.21.0/components/prism-go.min.js"></script>
<script src="prism-live.js?load=css,html,javascript"></script>
</body>
</html>